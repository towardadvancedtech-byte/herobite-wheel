<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta name="x-poe-datastore-behavior" content="local_only"><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hero Bite Burger - Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'hero-red': '#dc2626',
                        'hero-green': '#16a34a',
                        'hero-yellow': '#eab308',
                        'hero-blue': '#2563eb',
                        'hero-orange': '#ea580c'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Tajawal', sans-serif;
        }
        
        /* Realistic Wheel Styles */
        .wheel-container {
            position: relative;
            perspective: 1000px;
        }
        
        .wheel {
            position: relative;
            border-radius: 50%;
            transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1);
            box-shadow: 
                0 0 0 8px #8B4513,
                0 0 0 12px #D2691E,
                0 0 20px rgba(0,0,0,0.3),
                inset 0 0 50px rgba(255,255,255,0.1);
            transform-style: preserve-3d;
            overflow: hidden;
            background: #f0f0f0;
        }
        
        .wheel.spinning {
            animation: wheelGlow 0.1s infinite alternate;
        }
        
        @keyframes wheelGlow {
            from { box-shadow: 0 0 0 8px #8B4513, 0 0 0 12px #D2691E, 0 0 30px rgba(255,215,0,0.8), inset 0 0 50px rgba(255,255,255,0.2); }
            to { box-shadow: 0 0 0 8px #8B4513, 0 0 0 12px #D2691E, 0 0 50px rgba(255,215,0,1), inset 0 0 70px rgba(255,255,255,0.3); }
        }
        
        .wheel-segment {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 50%;
            height: 2px;
            background: rgba(255,255,255,0.3);
            transform-origin: 0 0;
            pointer-events: none;
        }
        
        .wheel-segment.winner {
            animation: winnerGlow 1s infinite alternate;
            z-index: 5;
        }
        
        @keyframes winnerGlow {
            from { 
                filter: brightness(1.5) saturate(1.5);
                box-shadow: inset 0 0 20px rgba(255,255,255,0.6);
            }
            to { 
                filter: brightness(2) saturate(2);
                box-shadow: inset 0 0 40px rgba(255,255,255,0.9);
            }
        }
        
        /* Wheel Pointer */
        .wheel-pointer {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
        }
        
        .pointer-triangle {
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 40px solid #dc2626;
            position: relative;
        }
        
        .pointer-triangle::before {
            content: '';
            position: absolute;
            top: -38px;
            left: -18px;
            width: 0;
            height: 0;
            border-left: 18px solid transparent;
            border-right: 18px solid transparent;
            border-top: 36px solid #ffd700;
        }
        
        .pointer-triangle::after {
            content: '';
            position: absolute;
            top: -35px;
            left: -15px;
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 30px solid #dc2626;
        }
        
        /* Center Logo */
        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 4px solid #8B4513;
            box-shadow: 
                0 0 0 2px #ffd700,
                0 0 20px rgba(255,215,0,0.5),
                inset 0 0 20px rgba(255,255,255,0.3);
            z-index: 15;
            overflow: hidden;
        }
        
        /* Light Effects */
        .light-effect {
            position: absolute;
            top: -50px;
            left: -50px;
            right: -50px;
            bottom: -50px;
            border-radius: 50%;
            pointer-events: none;
            opacity: 0;
            background: radial-gradient(circle, rgba(255,215,0,0.3) 0%, transparent 70%);
        }
        
        .wheel.spinning .light-effect {
            animation: lightPulse 0.2s infinite;
        }
        
        @keyframes lightPulse {
            0%, 100% { opacity: 0; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }
        
        /* Confetti Effect */
        .confetti {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }
        
        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ffd700;
            animation: confetti-fall 3s linear infinite;
        }
        
        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(360deg);
            }
        }
        
        .celebrate {
            animation: celebrate 1s ease-in-out;
        }
        
        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .glow {
            box-shadow: 0 0 20px rgba(220, 38, 38, 0.5);
        }
        
        .loading {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .file-upload {
            position: relative;
            overflow: hidden;
            display: inline-block;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-upload:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .file-upload input[type=file] {
            position: absolute;
            left: -9999px;
        }
        
        /* Status indicators */
        .status-success { @apply text-green-600 bg-green-50 dark:bg-green-900/20 dark:text-green-400; }
        .status-error { @apply text-red-600 bg-red-50 dark:bg-red-900/20 dark:text-red-400; }
        .status-warning { @apply text-yellow-600 bg-yellow-50 dark:bg-yellow-900/20 dark:text-yellow-400; }
        
        /* Form enhancements */
        .form-input {
            @apply w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg 
                   focus:ring-2 focus:ring-hero-red focus:border-transparent 
                   dark:bg-gray-700 dark:text-white transition-all duration-200;
        }
        
        .form-input:focus {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.15);
        }
        
        /* Progress bar */
        .progress-bar {
            @apply w-full bg-gray-200 rounded-full h-2 dark:bg-gray-700;
        }
        
        .progress-fill {
            @apply bg-hero-red h-2 rounded-full transition-all duration-300 ease-out;
        }
        
        /* Modal improvements */
        .modal-backdrop {
            backdrop-filter: blur(4px);
            background: rgba(0, 0, 0, 0.5);
        }
        
        .modal-content {
            transform: scale(0.95);
            transition: all 0.3s ease-out;
        }
        
        .modal-content.show {
            transform: scale(1);
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #dc2626;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #b91c1c;
        }
    </style>
<script src="https://puc.poecdn.net/authenticated_preview_page/syncedState.bd4eeeb8e8e02052ee92.js"></script></head>
<body class="bg-gradient-to-br from-orange-50 to-red-50 dark:from-gray-900 dark:to-gray-800 min-h-screen">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-50">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 text-center modal-content">
            <div class="loading w-12 h-12 border-4 border-hero-red border-t-transparent rounded-full mx-auto mb-4"></div>
            <p class="text-gray-700 dark:text-gray-300 font-semibold" id="loadingText">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
            <div class="progress-bar mt-4">
                <div class="progress-fill" id="loadingProgress" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <!-- Status Toast -->
    <div id="statusToast" class="hidden fixed top-4 right-4 z-50 max-w-sm">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg border-l-4 p-4" id="toastContent">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <span id="toastIcon" class="text-2xl"></span>
                </div>
                <div class="mr-3">
                    <p id="toastMessage" class="text-sm font-medium"></p>
                </div>
                <button onclick="hideToast()" class="mr-2 flex-shrink-0 rounded-full p-1 hover:bg-gray-100 dark:hover:bg-gray-700">
                    <span class="sr-only">Ø¥ØºÙ„Ø§Ù‚</span>
                    <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Confetti Container -->
    <div id="confettiContainer" class="confetti hidden"></div>

    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header with Logo -->
        <div class="text-center mb-8">
            <div class="inline-block bg-gradient-to-br from-yellow-400 to-yellow-500 rounded-3xl p-6 mb-6 shadow-2xl border-4 border-orange-500 hover:scale-105 transition-transform duration-300">
                <img src="https://pfst.cf2.poecdn.net/base/image/6d279fccf7ba7374e9d5428043b9bbfc74b2a36348b7b7f3f7126c329183a32a?w=574&amp;h=787" alt="Hero Bite Burger Logo" class="w-24 h-32 mx-auto mb-4 object-contain">
                <div class="bg-gradient-to-r from-green-600 to-green-700 text-white px-4 py-2 rounded-full font-bold text-sm shadow-lg">
                    HERO BITE BURGER
                </div>
            </div>
            <h1 class="text-4xl font-bold bg-gradient-to-r from-green-600 to-green-700 bg-clip-text text-transparent mb-2">HERO BITE BURGER</h1>
            <h2 class="text-2xl font-semibold text-gray-700 dark:text-gray-300 mb-2">ğŸ Ø¨Ø±Ù†Ø§Ù…Ø¬ "Ù‚ÙŠÙ‘Ù… ÙˆØ§Ø±Ø¨Ø­" ğŸ</h2>
            <p class="text-lg text-gray-600 dark:text-gray-400">Ø¯ÙˆÙ‘Ø± Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸ ÙˆØ§Ø±Ø¨Ø­ Ø¬ÙˆØ§Ø¦Ø² Ù…Ø°Ù‡Ù„Ø©!</p>
            
            <!-- Stats Display -->
            <div id="statsDisplay" class="hidden mt-6 grid grid-cols-2 md:grid-cols-3 gap-4">
                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-md">
                    <div class="text-2xl font-bold text-hero-red" id="totalParticipants">0</div>
                    <div class="text-sm text-gray-600 dark:text-gray-400">Ù…Ø´Ø§Ø±Ùƒ</div>
                </div>
                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-md">
                    <div class="text-2xl font-bold text-hero-green" id="totalWinners">0</div>
                    <div class="text-sm text-gray-600 dark:text-gray-400">ÙØ§Ø¦Ø²</div>
                </div>
                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-md md:col-span-1 col-span-2">
                    <div class="text-2xl font-bold text-hero-yellow" id="totalPrizes">0</div>
                    <div class="text-sm text-gray-600 dark:text-gray-400">Ø¬Ø§Ø¦Ø²Ø© Ù…ØªØ§Ø­Ø©</div>
                </div>
            </div>
        </div>

        <!-- Registration Form -->
        <div id="registrationForm" class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 mb-8 transform hover:scale-[1.01] transition-transform duration-300">
            <h3 class="text-2xl font-bold text-gray-800 dark:text-white mb-6 text-center flex items-center justify-center">
                <span class="mr-3">ğŸ“</span>
                Ø³Ø¬Ù‘Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©
                <span class="ml-3">ğŸ¯</span>
            </h3>
            
            <form id="customerForm" class="space-y-6">
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-gray-700 dark:text-gray-300 font-semibold mb-2 flex items-center">
                            <span class="mr-2">ğŸ‘¤</span>
                            Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„
                        </label>
                        <input type="text" id="customerName" required="" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„">
                        <div class="text-xs text-gray-500 mt-1 hidden" id="nameError"></div>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 dark:text-gray-300 font-semibold mb-2 flex items-center">
                            <span class="mr-2">ğŸ“±</span>
                            Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„
                        </label>
                        <input type="tel" id="customerPhone" required="" class="form-input" placeholder="9XXXXXXXX Ø£Ùˆ +9689XXXXXXXX">
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">ØµÙŠØºØ© Ø§Ù„Ø±Ù‚Ù…: 9XXXXXXXX Ø£Ùˆ 7XXXXXXXX Ø£Ùˆ +9689XXXXXXXX</p>
                        <div class="text-xs text-red-500 mt-1 hidden" id="phoneError"></div>
                    </div>
                    
                    <div class="md:col-span-2">
                        <label class="block text-gray-700 dark:text-gray-300 font-semibold mb-2 flex items-center">
                            <span class="mr-2">ğŸ“§</span>
                            Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
                        </label>
                        <input type="email" id="customerEmail" required="" class="form-input" placeholder="example@email.com">
                        <div class="text-xs text-red-500 mt-1 hidden" id="emailError"></div>
                    </div>
                </div>

                <!-- Screenshot Upload -->
                <div>
                    <label class="block text-gray-700 dark:text-gray-300 font-semibold mb-2 flex items-center">
                        <span class="mr-2">ğŸ“·</span>
                        Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ… (Ø¥Ø¬Ø¨Ø§Ø±ÙŠ)
                    </label>
                    <div class="file-upload w-full bg-gray-50 dark:bg-gray-700 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center transition-all duration-300 hover:border-hero-red hover:bg-gray-100 dark:hover:bg-gray-600">
                        <input type="file" id="screenshotFile" accept="image/*" required="">
                        <div id="uploadText">
                            <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                            <p class="text-gray-600 dark:text-gray-400 font-semibold">Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø© ØªÙ‚ÙŠÙŠÙ… Google</p>
                            <p class="text-xs text-gray-500 dark:text-gray-500 mt-1">PNG, JPG Ø­ØªÙ‰ <span id="maxFileSize">5</span>MB</p>
                        </div>
                        <div id="filePreview" class="hidden">
                            <img id="previewImage" class="mx-auto max-h-32 rounded-lg mb-2 shadow-md">
                            <p id="fileName" class="text-sm text-gray-600 dark:text-gray-400 font-medium"></p>
                            <button type="button" onclick="removeFile()" class="mt-2 text-xs text-red-500 hover:text-red-700 underline">
                                ğŸ—‘ï¸ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµÙˆØ±Ø©
                            </button>
                        </div>
                    </div>
                    <div class="text-xs text-red-500 mt-1 hidden" id="fileError"></div>
                </div>
                
                <div class="p-6 bg-gradient-to-r from-hero-yellow/20 to-hero-orange/20 rounded-xl border border-hero-yellow/30">
                    <div class="mb-4">
                        <h4 class="font-bold text-gray-800 dark:text-gray-200 mb-3 flex items-center">
                            <span class="mr-2">ğŸ“‹</span>
                            Ø®Ø·ÙˆØ§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©:
                        </h4>
                        <ol class="text-sm text-gray-700 dark:text-gray-300 space-y-2">
                            <li class="flex items-start">
                                <span class="bg-hero-red text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">1</span>
                                Ù‚ÙŠÙ‘Ù… Ù…Ø·Ø¹Ù… Ù‡ÙŠØ±ÙˆØ¨Ø§ÙŠØª Ø¹Ù„Ù‰ Google Reviews (â­â­â­â­â­)
                            </li>
                            <li class="flex items-start">
                                <span class="bg-hero-red text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">2</span>
                                Ø£Ø®Ø° Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø© ÙˆØ§Ø¶Ø­Ø© Ù„Ù„ØªÙ‚ÙŠÙŠÙ…
                            </li>
                            <li class="flex items-start">
                                <span class="bg-hero-red text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">3</span>
                                Ø§Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£Ø¹Ù„Ø§Ù‡
                            </li>
                            <li class="flex items-start">
                                <span class="bg-hero-red text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">4</span>
                                Ø§Ù…Ù„Ø£ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©
                            </li>
                            <li class="flex items-start">
                                <span class="bg-hero-green text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">5</span>
                                Ø¯ÙˆÙ‘Ø± Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸ ÙˆØ§Ø±Ø¨Ø­ Ø¬Ø§Ø¦Ø²ØªÙƒ! ğŸ‰
                            </li>
                        </ol>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-700 rounded-lg p-4 border-2 border-hero-red shadow-md">
                        <p class="text-sm font-semibold text-hero-red mb-3 flex items-center">
                            <span class="mr-2">ğŸŒŸ</span>
                            Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„ØªÙ‚ÙŠÙŠÙ… Ù…Ø·Ø¹Ù… Ù‡ÙŠØ±ÙˆØ¨Ø§ÙŠØª Ø¹Ù„Ù‰ Ø®Ø±ÙŠØ·Ø© Ù‚ÙˆÙ‚Ù„:
                        </p>
                        <a href="https://maps.app.goo.gl/gK7c3rSBKMGQp1MaA" target="_blank" class="inline-flex items-center justify-center w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white font-bold py-3 px-4 rounded-lg hover:from-blue-700 hover:to-blue-800 transition-all duration-300 transform hover:scale-105 shadow-lg group">
                            <span class="mr-2 group-hover:scale-110 transition-transform">ğŸ—ºï¸</span>
                            ÙØªØ­ Ø±Ø§Ø¨Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙÙŠ Ø®Ø±ÙŠØ·Ø© Ù‚ÙˆÙ‚Ù„
                            <span class="ml-2 group-hover:scale-110 transition-transform">â­</span>
                        </a>
                    </div>
                    
                    <div class="mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-700">
                        <p class="text-xs text-blue-700 dark:text-blue-300 text-center font-medium flex items-center justify-center">
                            <span class="mr-2">ğŸ“±</span>
                            Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ù…Ø³Ù…ÙˆØ­Ø© Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ù„ÙƒÙ„ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ø£Ùˆ Ø¥ÙŠÙ…ÙŠÙ„
                            <span class="ml-2">âœ…</span>
                        </p>
                    </div>
                </div>
                
                <button type="submit" id="submitButton" class="w-full bg-gradient-to-r from-hero-red to-hero-orange text-white font-bold py-4 px-8 rounded-xl text-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none group">
                    <span class="group-hover:scale-110 transition-transform inline-block mr-2">ğŸ¯</span>
                    Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨ ÙˆØ§Ø¯Ø± Ø§Ù„Ø¹Ø¬Ù„Ø©
                    <span class="group-hover:scale-110 transition-transform inline-block ml-2">ğŸ²</span>
                </button>
            </form>
        </div>

        <!-- Wheel Game -->
        <div id="wheelGame" class="hidden bg-gradient-to-br from-red-600 via-red-700 to-red-800 rounded-2xl shadow-2xl p-8 text-center">
            <!-- Hero Bite Power Wheel Title -->
            <div class="mb-8">
                <h1 class="text-4xl md:text-5xl font-black text-yellow-400 mb-2 drop-shadow-lg transform -rotate-2 hover:rotate-0 transition-transform duration-300" style="text-shadow: 3px 3px 0px #8B4513, -1px -1px 0px #8B4513, 1px -1px 0px #8B4513, -1px 1px 0px #8B4513;">
                    HERO BITE
                </h1>
                <h2 class="text-3xl md:text-4xl font-black text-yellow-400 drop-shadow-lg transform rotate-1 hover:-rotate-1 transition-transform duration-300" style="text-shadow: 3px 3px 0px #8B4513, -1px -1px 0px #8B4513, 1px -1px 0px #8B4513, -1px 1px 0px #8B4513;">
                    POWER WHEEL
                </h2>
            </div>
            
            <!-- Customer Info Display -->
            <div id="customerInfo" class="bg-gradient-to-r from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600 rounded-xl p-6 mb-8 shadow-inner">
                <div class="flex items-center justify-center mb-2">
                    <span class="text-2xl mr-2">ğŸ‘‹</span>
                    <p class="text-xl font-bold text-gray-800 dark:text-white">
                        Ù…Ø±Ø­Ø¨Ø§Ù‹ <span id="displayName" class="text-hero-red"></span>!
                    </p>
                    <span class="text-2xl ml-2">ğŸ‰</span>
                </div>
                <p class="text-sm text-gray-600 dark:text-gray-400 flex items-center justify-center">
                    <span class="mr-2">ğŸ“±</span>
                    Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„: <span id="displayPhone" class="font-semibold mr-2"></span>
                    <span class="text-green-500">âœ…</span>
                </p>
                <div id="participantStatus" class="mt-3 p-2 rounded-lg text-xs"></div>
            </div>
            
            <!-- Wheel and Hero Container -->
            <div class="flex flex-col lg:flex-row items-center justify-center gap-8 mb-8">
                <!-- Realistic Wheel Container -->
                <div class="wheel-container relative w-80 h-80">
                    <!-- Wheel Pointer -->
                    <div class="wheel-pointer">
                        <div class="pointer-triangle"></div>
                    </div>
                    
                    <!-- Light Effect -->
                    <div class="light-effect"></div>
                    
                    <!-- Main Wheel -->
                    <div id="wheel" class="wheel w-full h-full relative">
                        <!-- Wheel segments will be generated by JavaScript -->
                    </div>
                    
                    <!-- Center Logo -->
                    <div class="wheel-center">
                        <img src="https://pfst.cf2.poecdn.net/base/image/6d279fccf7ba7374e9d5428043b9bbfc74b2a36348b7b7f3f7126c329183a32a?w=574&amp;h=787" alt="Hero Bite" class="w-12 h-16 object-contain">
                        <div class="text-[8px] font-black text-green-800">HERO<br>BITE</div>
                    </div>
                </div>
                
                <!-- Hero Character -->
                <div class="text-center lg:text-left">
                    <div class="relative transform hover:scale-110 transition-transform duration-300 mb-6">
                        <img src="https://pfst.cf2.poecdn.net/base/image/6d279fccf7ba7374e9d5428043b9bbfc74b2a36348b7b7f3f7126c329183a32a?w=574&amp;h=787" alt="Hero Bite Burger Character" class="w-32 h-40 mx-auto object-contain drop-shadow-xl">
                        <!-- Floating animation dots -->
                        <div class="absolute top-0 left-0 w-2 h-2 bg-yellow-400 rounded-full animate-ping" style="animation-delay: 0s;"></div>
                        <div class="absolute top-4 right-2 w-1 h-1 bg-yellow-300 rounded-full animate-ping" style="animation-delay: 0.5s;"></div>
                        <div class="absolute bottom-8 left-2 w-1.5 h-1.5 bg-yellow-500 rounded-full animate-ping" style="animation-delay: 1s;"></div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-green-600 to-green-700 text-white px-6 py-3 rounded-full font-bold text-lg shadow-lg mb-4 hover:from-green-500 hover:to-green-600 transition-colors">
                        HEROBITE
                    </div>
                    
                    <div class="bg-gradient-to-r from-yellow-400 to-yellow-500 text-green-800 px-4 py-2 rounded-lg font-black text-xl shadow-lg mb-4 hover:from-yellow-300 hover:to-yellow-400 transition-colors">
                        HERO BITE BURGER
                    </div>
                    
                    <div class="text-white font-semibold">
                        <p class="text-lg mb-2">ğŸ” Ø·Ø¹Ù… Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ!</p>
                        <p class="text-sm">Ù‚ÙˆØ© ÙÙŠ ÙƒÙ„ Ù‚Ø¶Ù…Ø© âš¡</p>
                    </div>
                </div>
            </div>
            
            <button id="spinButton" onclick="spinWheel()" class="bg-gradient-to-r from-hero-green to-hero-blue text-white font-bold py-4 px-8 rounded-xl text-xl shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 glow disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none group">
                <span id="spinIcon" class="group-hover:rotate-180 transition-transform duration-300 inline-block mr-2">ğŸ²</span>
                <span id="spinText">Ø¯ÙˆÙ‘Ø± Ø§Ù„Ø¹Ø¬Ù„Ø©</span>
                <span class="group-hover:rotate-180 transition-transform duration-300 inline-block ml-2">ğŸ¯</span>
            </button>
            
            <!-- Spin Counter -->
            <div id="spinCounter" class="mt-4 text-white/80 text-sm">
                <span id="spinsRemaining"></span>
            </div>
            
            <!-- Download Coupon Button (shown only after winning a real prize) -->
            <div id="downloadCouponSection" class="hidden mt-6">
                <div class="bg-yellow-400 border-2 border-yellow-600 rounded-lg p-4 mb-4 animate-pulse">
                    <p class="text-yellow-900 font-bold text-sm flex items-center justify-center">
                        <span class="mr-2">ğŸ‰</span>
                        Ù„Ø¯ÙŠÙƒ ÙƒÙˆØ¨ÙˆÙ† Ø¬Ø§Ø¦Ø²Ø©!
                        <span class="ml-2">ğŸ«</span>
                    </p>
                    <p class="text-yellow-800 text-xs mt-1">ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ† ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª</p>
                </div>
                <button onclick="downloadPrizeImage()" class="bg-gradient-to-r from-yellow-500 to-yellow-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 group">
                    <span class="group-hover:scale-110 transition-transform inline-block mr-2">ğŸ“¥</span>
                    ØªØ­Ù…ÙŠÙ„ ÙƒÙˆØ¨ÙˆÙ† Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©
                    <span class="group-hover:scale-110 transition-transform inline-block ml-2">ğŸ«</span>
                </button>
            </div>
        </div>

        <!-- Result Modal -->
        <div id="resultModal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full p-8 text-center modal-content">
                <div class="text-6xl mb-4" id="resultEmoji">ğŸ‰</div>
                <h3 class="text-2xl font-bold text-hero-red mb-4" id="resultTitle">Ù…Ø¨Ø±ÙˆÙƒ! Ù„Ù‚Ø¯ Ø±Ø¨Ø­Øª</h3>
                <div id="prizeDisplay" class="text-xl font-semibold text-gray-800 dark:text-white mb-6 p-4 bg-hero-yellow/20 rounded-lg border-2 border-hero-yellow/50"></div>
                <p id="prizeInstructions" class="text-sm text-gray-600 dark:text-gray-400 mb-6">Ø§Ø­ØªÙØ¸ Ø¨Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ† ÙˆØ£Ø¸Ù‡Ø±Ù‡ Ù„Ù„ÙƒØ§Ø´ÙŠØ± Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¬Ø§Ø¦Ø²ØªÙƒ</p>
                
                <div class="flex flex-col space-y-3">
                    <button id="downloadButton" onclick="downloadPrizeImage()" class="bg-hero-green text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 transition-all duration-300 transform hover:scale-105 flex items-center justify-center">
                        <span class="mr-2">ğŸ“¥</span>
                        ØªØ­Ù…ÙŠÙ„ ÙƒÙˆØ¨ÙˆÙ† Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©
                        <span class="ml-2">ğŸ«</span>
                    </button>
                    <button onclick="newCustomer()" class="bg-hero-blue text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-all duration-300 transform hover:scale-105 flex items-center justify-center">
                        <span class="mr-2">ğŸ”„</span>
                        Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
                        <span class="ml-2">ğŸ‘¤</span>
                    </button>
                    <button onclick="closeModal()" class="bg-gray-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-600 transition-all duration-300 transform hover:scale-105 flex items-center justify-center">
                        <span class="mr-2">âœ…</span>
                        Ø¥ØºÙ„Ø§Ù‚
                        <span class="ml-2">âŒ</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration - ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ« Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ø¹Ø¯ Ù†Ø´Ø± Google Apps Script
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxO7-WRgplsPbCq4Edsqc7mN8ZhpxsBOg6iq7jjrWpx2yf8fyxnonMRQxP7CObmF5xSnA/exec';
        
        // Settings (will be loaded from Google Sheets)
        let appSettings = {
            maxFileSize: 5, // MB
            maxAttempts: 1,
            couponValidityDays: 30,
            allowDuplicates: false
        };
        
        // Global variables
        let currentCustomer = null;
        let isSpinning = false;
        let prizes = [];
        let currentScreenshot = null;
        let audioContext = null;
        let winningSegmentIndex = -1;
        let hasSpun = false;
        let hasWonRealPrize = false;
        let participantId = null;
        let spinsRemaining = 1;

        // Prize configurations (fallback if Google Sheets fails)
        const defaultPrizes = [
            { id: 1, text: "Ø¨Ø·Ø§Ø·Ø³ Ù…Ø¬Ø§Ù†ÙŠØ©", color: "#2563eb", icon: "ğŸŸ", probability: 20, is_real: true },
            { id: 2, text: "Ø®ØµÙ… 20%", color: "#eab308", icon: "ğŸ’°", probability: 10, is_real: true },
            { id: 3, text: "Ù…Ø´Ø±ÙˆØ¨ Ù…Ø¬Ø§Ù†ÙŠ", color: "#16a34a", icon: "ğŸ¥¤", probability: 25, is_real: true },
            { id: 4, text: "Ø®ØµÙ… 15%", color: "#ea580c", icon: "ğŸ¯", probability: 15, is_real: true },
            { id: 5, text: "Ø£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©", color: "#16a34a", icon: "ğŸ”„", probability: 15, is_real: false },
            { id: 6, text: "Ø®ØµÙ… 10%", color: "#2563eb", icon: "ğŸ’³", probability: 10, is_real: true },
            { id: 7, text: "Ø³Ø§Ù†Ø¯ÙˆÙŠØªØ´ Ù…Ø¬Ø§Ù†ÙŠ", color: "#dc2626", icon: "ğŸ¥ª", probability: 3, is_real: true },
            { id: 8, text: "Ø­Ù„ÙˆÙ‰ Ù…Ø¬Ø§Ù†ÙŠØ©", color: "#ea580c", icon: "ğŸ°", probability: 2, is_real: true }
        ];

        // Dark mode support
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initAudio();
            loadAppSettings();
            loadPrizes();
            loadStats();
            setupFileUpload();
            setupForm();
            setupValidation();
        });

        // Initialize Web Audio API
        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                console.log('Web Audio API not supported');
            }
        }

        // Load app settings from Google Sheets
        async function loadAppSettings() {
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL + '?action=getSettings');
                const data = await response.json();
                if (data.success && data.settings) {
                    appSettings = { ...appSettings, ...data.settings };
                    document.getElementById('maxFileSize').textContent = appSettings.maxFileSize;
                }
            } catch (error) {
                console.error('Error loading settings:', error);
                showToast('ØªØ­Ø°ÙŠØ±', 'ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©', 'warning');
            }
        }

        // Load stats
        async function loadStats() {
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL + '?action=getStats');
                const data = await response.json();
                if (data.success && data.stats) {
                    document.getElementById('totalParticipants').textContent = data.stats.participants || 0;
                    document.getElementById('totalWinners').textContent = data.stats.winners || 0;
                    document.getElementById('totalPrizes').textContent = data.stats.availablePrizes || 0;
                    document.getElementById('statsDisplay').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Load prizes from Google Sheets
        async function loadPrizes() {
            showLoading(true, 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬ÙˆØ§Ø¦Ø²...', 25);
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL + '?action=getPrizes');
                const data = await response.json();
                if (data.success && data.prizes && data.prizes.length > 0) {
                    prizes = data.prizes;
                    showToast('Ù†Ø¬Ø­', 'ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬ÙˆØ§Ø¦Ø² Ø¨Ù†Ø¬Ø§Ø­', 'success');
                } else {
                    prizes = defaultPrizes;
                    showToast('ØªØ­Ø°ÙŠØ±', 'ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬ÙˆØ§Ø¦Ø² Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©', 'warning');
                }
            } catch (error) {
                console.error('Error loading prizes:', error);
                prizes = defaultPrizes;
                showToast('Ø®Ø·Ø£', 'ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬ÙˆØ§Ø¦Ø²ØŒ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬ÙˆØ§Ø¦Ø² Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©', 'error');
            }
            showLoading(false);
            initWheel();
        }

        // Initialize realistic wheel using SVG
        function initWheel() {
            const wheel = document.getElementById('wheel');
            const segmentAngle = 360 / prizes.length;
            
            wheel.innerHTML = '';
            
            // Create SVG wheel
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.style.width = '100%';
            svg.style.height = '100%';
            svg.style.position = 'absolute';
            svg.style.top = '0';
            svg.style.left = '0';
            svg.setAttribute('viewBox', '0 0 320 320');
            
            const centerX = 160;
            const centerY = 160;
            const radius = 150;
            
            prizes.forEach((prize, index) => {
                const startAngle = (index * segmentAngle - 90) * (Math.PI / 180);
                const endAngle = ((index + 1) * segmentAngle - 90) * (Math.PI / 180);
                
                const x1 = centerX + radius * Math.cos(startAngle);
                const y1 = centerY + radius * Math.sin(startAngle);
                const x2 = centerX + radius * Math.cos(endAngle);
                const y2 = centerY + radius * Math.sin(endAngle);
                
                const largeArc = segmentAngle > 180 ? 1 : 0;
                
                // Create path for segment
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                const pathData = `M ${centerX} ${centerY} L ${x1} ${y1} A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2} Z`;
                path.setAttribute('d', pathData);
                path.setAttribute('fill', prize.color);
                path.setAttribute('stroke', '#ffffff');
                path.setAttribute('stroke-width', '2');
                path.setAttribute('data-index', index);
                path.classList.add('wheel-segment');
                
                svg.appendChild(path);
                
                // Add text
                const textAngle = (index * segmentAngle + segmentAngle / 2 - 90) * (Math.PI / 180);
                const textRadius = radius * 0.7;
                const textX = centerX + textRadius * Math.cos(textAngle);
                const textY = centerY + textRadius * Math.sin(textAngle);
                
                // Icon text
                const iconText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                iconText.setAttribute('x', textX);
                iconText.setAttribute('y', textY - 8);
                iconText.setAttribute('text-anchor', 'middle');
                iconText.setAttribute('dominant-baseline', 'central');
                iconText.setAttribute('fill', 'white');
                iconText.setAttribute('font-size', '20');
                iconText.setAttribute('font-weight', 'bold');
                iconText.style.filter = 'drop-shadow(2px 2px 4px rgba(0,0,0,0.8))';
                iconText.textContent = prize.icon;
                
                // Prize text with better truncation
                const prizeText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                prizeText.setAttribute('x', textX);
                prizeText.setAttribute('y', textY + 12);
                prizeText.setAttribute('text-anchor', 'middle');
                prizeText.setAttribute('dominant-baseline', 'central');
                prizeText.setAttribute('fill', 'white');
                prizeText.setAttribute('font-size', '12');
                prizeText.setAttribute('font-weight', '900');
                prizeText.setAttribute('font-family', 'Tajawal, Arial, sans-serif');
                prizeText.style.filter = 'drop-shadow(2px 2px 4px rgba(0,0,0,0.8))';
                
                // Truncate long text
                let displayText = prize.text;
                if (displayText.length > 10) {
                    displayText = displayText.substring(0, 8) + '..';
                }
                prizeText.textContent = displayText;
                
                svg.appendChild(iconText);
                svg.appendChild(prizeText);
            });
            
            wheel.appendChild(svg);
        }

        // Setup file upload with enhanced validation
        function setupFileUpload() {
            const fileInput = document.getElementById('screenshotFile');
            const uploadArea = document.querySelector('.file-upload');
            const uploadText = document.getElementById('uploadText');
            const filePreview = document.getElementById('filePreview');
            const previewImage = document.getElementById('previewImage');
            const fileName = document.getElementById('fileName');

            // Drag and drop support
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('border-hero-red', 'bg-hero-red/5');
            });

            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('border-hero-red', 'bg-hero-red/5');
            });

            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('border-hero-red', 'bg-hero-red/5');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelection(files[0]);
                }
            });

            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    handleFileSelection(file);
                }
            });

            function handleFileSelection(file) {
                clearFileError();
                
                // Validate file size
                const maxSize = appSettings.maxFileSize * 1024 * 1024; // Convert to bytes
                if (file.size > maxSize) {
                    showFileError(`Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹. Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ ${appSettings.maxFileSize} Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª.`);
                    return;
                }

                // Validate file type
                if (!file.type.startsWith('image/')) {
                    showFileError('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù ØµÙˆØ±Ø© ØµØ­ÙŠØ­ (PNG, JPG, Ø¥Ù„Ø®).');
                    return;
                }

                // Validate file extensions
                const allowedExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp'];
                const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
                if (!allowedExtensions.includes(fileExtension)) {
                    showFileError('Ø§Ù…ØªØ¯Ø§Ø¯ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…. Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…: JPG, PNG, GIF, WebP');
                    return;
                }

                currentScreenshot = file;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImage.src = e.target.result;
                    fileName.textContent = file.name;
                    uploadText.classList.add('hidden');
                    filePreview.classList.remove('hidden');
                    
                    // Add success styling
                    uploadArea.classList.add('border-green-500', 'bg-green-50', 'dark:bg-green-900/20');
                    uploadArea.classList.remove('border-gray-300', 'dark:border-gray-600');
                };
                reader.readAsDataURL(file);
            }
        }

        // Remove uploaded file
        function removeFile() {
            currentScreenshot = null;
            document.getElementById('screenshotFile').value = '';
            document.getElementById('uploadText').classList.remove('hidden');
            document.getElementById('filePreview').classList.add('hidden');
            
            const uploadArea = document.querySelector('.file-upload');
            uploadArea.classList.remove('border-green-500', 'bg-green-50', 'dark:bg-green-900/20');
            uploadArea.classList.add('border-gray-300', 'dark:border-gray-600');
            
            clearFileError();
        }

        // Setup form with enhanced validation
        function setupForm() {
            const form = document.getElementById('customerForm');
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                if (validateForm()) {
                    validateAndStartGame();
                }
            });
        }

        // Setup real-time validation
        function setupValidation() {
            const nameInput = document.getElementById('customerName');
            const phoneInput = document.getElementById('customerPhone');
            const emailInput = document.getElementById('customerEmail');

            nameInput.addEventListener('blur', validateName);
            phoneInput.addEventListener('blur', validatePhone);
            emailInput.addEventListener('blur', validateEmail);
            
            // Real-time phone formatting
            phoneInput.addEventListener('input', function() {
                let value = this.value.replace(/\D/g, '');
                if (value.startsWith('968')) {
                    value = '+' + value;
                }
                this.value = value;
            });
        }

        // Validation functions
        function validateName() {
            const name = document.getElementById('customerName').value.trim();
            const error = document.getElementById('nameError');
            
            if (name.length < 2) {
                showFieldError('nameError', 'Ø§Ù„Ø§Ø³Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ«Ø± Ù…Ù† Ø­Ø±ÙÙŠÙ†');
                return false;
            }
            if (!/^[\u0600-\u06FFa-zA-Z\s]+$/.test(name)) {
                showFieldError('nameError', 'Ø§Ù„Ø§Ø³Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø­Ø±Ù ÙÙ‚Ø·');
                return false;
            }
            
            clearFieldError('nameError');
            return true;
        }

        function validatePhone() {
            const phone = document.getElementById('customerPhone').value.trim();
            
            if (!validateOmanPhone(phone)) {
                showFieldError('phoneError', 'Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ ØºÙŠØ± ØµØ­ÙŠØ­. Ø§Ø³ØªØ®Ø¯Ù…: 9XXXXXXXX Ø£Ùˆ 7XXXXXXXX Ø£Ùˆ +9689XXXXXXXX');
                return false;
            }
            
            clearFieldError('phoneError');
            return true;
        }

        function validateEmail() {
            const email = document.getElementById('customerEmail').value.trim();
            
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                showFieldError('emailError', 'Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­');
                return false;
            }
            
            clearFieldError('emailError');
            return true;
        }

        function validateForm() {
            const name = validateName();
            const phone = validatePhone();
            const email = validateEmail();
            const file = currentScreenshot !== null;
            
            if (!file) {
                showFileError('ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…');
            }
            
            return name && phone && email && file;
        }

        // Error handling functions
        function showFieldError(fieldId, message) {
            const errorElement = document.getElementById(fieldId);
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
            errorElement.classList.add('status-error');
        }

        function clearFieldError(fieldId) {
            const errorElement = document.getElementById(fieldId);
            errorElement.classList.add('hidden');
            errorElement.classList.remove('status-error');
        }

        function showFileError(message) {
            const errorElement = document.getElementById('fileError');
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
            errorElement.classList.add('status-error');
        }

        function clearFileError() {
            const errorElement = document.getElementById('fileError');
            errorElement.classList.add('hidden');
            errorElement.classList.remove('status-error');
        }

        // Validate Oman phone numbers
        function validateOmanPhone(phone) {
            const cleanPhone = phone.replace(/[\s()-]/g, '');
            const localPattern = /^[97]\d{8}$/;
            const intlPattern = /^\+968[97]\d{8}$/;
            return localPattern.test(cleanPhone) || intlPattern.test(cleanPhone);
        }

        // Format phone number
        function formatPhoneNumber(phone) {
            const cleanPhone = phone.replace(/[\s()-]/g, '');
            if (/^[97]\d{8}$/.test(cleanPhone)) {
                return `+968${cleanPhone}`;
            }
            return cleanPhone;
        }

        // Check if prize is real
        function isRealPrize(prize) {
            return prize.is_real === true;
        }

        // Validate and start game with Google Sheets integration
        async function validateAndStartGame() {
            const name = document.getElementById('customerName').value.trim();
            const phone = document.getElementById('customerPhone').value.trim();
            const email = document.getElementById('customerEmail').value.trim();

            const submitButton = document.getElementById('submitButton');
            submitButton.disabled = true;
            submitButton.innerHTML = '<div class="loading w-5 h-5 border-2 border-white border-t-transparent rounded-full inline-block mr-2"></div>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';

            showLoading(true, 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', 50);

            try {
                const formattedPhone = formatPhoneNumber(phone);

                // Prepare form data
                const formData = {
                    name: name,
                    phone: formattedPhone,
                    email: email,
                    timestamp: new Date().toISOString()
                };

                // Convert screenshot to base64 if available
                if (currentScreenshot) {
                    const base64 = await fileToBase64(currentScreenshot);
                    formData.screenshotBase64 = base64;
                    formData.screenshotName = currentScreenshot.name;
                    formData.screenshotSize = currentScreenshot.size;
                }

                // Register participant
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'registerParticipant',
                        data: formData
                    })
                });

                const result = await response.json();
                showLoading(false);

                if (result.success) {
                    participantId = result.participantId;
                    spinsRemaining = result.spinsRemaining || appSettings.maxAttempts;
                    
                    currentCustomer = {
                        id: participantId,
                        name: name,
                        phone: formattedPhone,
                        email: email,
                        timestamp: new Date()
                    };

                    showToast('Ù†Ø¬Ø­', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    showGameInterface();
                    
                } else if (result.error === 'duplicate') {
                    showToast('ØªÙ†Ø¨ÙŠÙ‡', 'Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ù…Ø³Ø¨Ù‚Ø§Ù‹ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', 'warning');
                } else {
                    throw new Error(result.message || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ');
                }

            } catch (error) {
                showLoading(false);
                console.error('Registration error:', error);
                showToast('Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'error');
            }

            submitButton.disabled = false;
            submitButton.innerHTML = '<span class="mr-2">ğŸ¯</span>Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨ ÙˆØ§Ø¯Ø± Ø§Ù„Ø¹Ø¬Ù„Ø©<span class="ml-2">ğŸ²</span>';
        }

        // Convert file to base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        // Show game interface
        function showGameInterface() {
            document.getElementById('registrationForm').classList.add('hidden');
            document.getElementById('wheelGame').classList.remove('hidden');
            
            // Display customer info
            document.getElementById('displayName').textContent = currentCustomer.name;
            document.getElementById('displayPhone').textContent = currentCustomer.phone;
            
            // Update spins counter
            updateSpinCounter();
            
            // Show participant status
            const statusDiv = document.getElementById('participantStatus');
            statusDiv.innerHTML = `
                <span class="status-success px-3 py-1 rounded-full text-xs font-semibold">
                    âœ… Ù…Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­ - Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ø¨
                </span>
            `;
        }

        // Update spin counter
        function updateSpinCounter() {
            const counterDiv = document.getElementById('spinsRemaining');
            if (spinsRemaining > 0) {
                counterDiv.innerHTML = `Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: <span class="text-yellow-400 font-bold">${spinsRemaining}</span>`;
            } else {
                counterDiv.innerHTML = `<span class="text-red-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…ØªØ¨Ù‚ÙŠØ©</span>`;
            }
        }

        // Spin wheel with enhanced effects and Google Sheets integration
        function spinWheel() {
            if (isSpinning) return;
            
            if (spinsRemaining <= 0) {
                showToast('ØªÙ†Ø¨ÙŠÙ‡', 'Ù„Ù‚Ø¯ Ø§Ø³ØªÙ†ÙØ¯Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©', 'warning');
                return;
            }
            
            isSpinning = true;
            const wheel = document.getElementById('wheel');
            const spinButton = document.getElementById('spinButton');
            const spinIcon = document.getElementById('spinIcon');
            const spinText = document.getElementById('spinText');
            
            spinButton.disabled = true;
            spinIcon.textContent = 'ğŸŒ€';
            spinText.textContent = 'Ø§Ù„Ø¹Ø¬Ù„Ø© ØªØ¯ÙˆØ±...';
            
            // Add spinning effects
            wheel.classList.add('spinning');
            
            // Play spinning sound
            playSpinSound();
            
            // Use weighted probability to select winning segment
            const winningPrize = selectPrizeByProbability();
            const randomSegmentIndex = prizes.findIndex(p => p.id === winningPrize.id);
            
            winningSegmentIndex = randomSegmentIndex;
            
            // Calculate rotation
            const segmentAngle = 360 / prizes.length;
            const randomSpins = Math.floor(Math.random() * 5) + 8;
            const segmentCenterAngle = (randomSegmentIndex * segmentAngle) + (segmentAngle / 2);
            const rotationToAlign = -segmentCenterAngle;
            const finalRotation = (randomSpins * 360) + rotationToAlign;
            
            wheel.style.transform = `rotate(${finalRotation}deg)`;
            
            // Show result after animation
            setTimeout(async () => {
                wheel.classList.remove('spinning');
                
                const actualWinningPrize = prizes[winningSegmentIndex];
                
                // Decrease spins remaining
                spinsRemaining--;
                updateSpinCounter();
                
                // Record prize in Google Sheets
                try {
                    const response = await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'recordPrize',
                            data: {
                                participantId: participantId,
                                prizeId: actualWinningPrize.id,
                                prizeText: actualWinningPrize.text,
                                isReal: isRealPrize(actualWinningPrize),
                                timestamp: new Date().toISOString()
                            }
                        })
                    });
                    
                    const result = await response.json();
                    if (result.success && result.couponCode) {
                        currentCustomer.couponCode = result.couponCode;
                    }
                } catch (error) {
                    console.error('Error recording prize:', error);
                }
                
                await highlightWinningSegment();
                await showPrizeResult(actualWinningPrize);
                
                isSpinning = false;
                
                // Reset button
                if (spinsRemaining > 0 && !isRealPrize(actualWinningPrize)) {
                    spinButton.disabled = false;
                    spinIcon.textContent = 'ğŸ²';
                    spinText.textContent = 'Ø¯ÙˆÙ‘Ø± Ù…Ø±Ø© Ø£Ø®Ø±Ù‰';
                } else {
                    spinIcon.textContent = 'âœ…';
                    spinText.textContent = 'Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©';
                }
                
                // If real prize won, show download section
                if (isRealPrize(actualWinningPrize)) {
                    hasWonRealPrize = true;
                    currentCustomer.prize = actualWinningPrize.text;
                    document.getElementById('downloadCouponSection').classList.remove('hidden');
                    spinsRemaining = 0; // End game after real prize
                    updateSpinCounter();
                }
                
            }, 4000);
        }

        // Highlight winning segment with enhanced effects
        async function highlightWinningSegment() {
            const segments = document.querySelectorAll('.wheel-segment');
            if (winningSegmentIndex >= 0 && segments[winningSegmentIndex]) {
                segments[winningSegmentIndex].classList.add('winner');
                playWinSound();
                createConfetti();
                
                // Update stats
                setTimeout(() => loadStats(), 1000);
            }
        }

        // Create enhanced confetti effect
        function createConfetti() {
            const confettiContainer = document.getElementById('confettiContainer');
            confettiContainer.classList.remove('hidden');
            
            const colors = ['#ffd700', '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3', '#54a0ff'];
            
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti-piece';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 3 + 's';
                    confetti.style.animationDuration = (Math.random() * 2 + 3) + 's';
                    confettiContainer.appendChild(confetti);
                    
                    setTimeout(() => {
                        if (confetti.parentNode) {
                            confetti.remove();
                        }
                    }, 5000);
                }, i * 30);
            }
            
            setTimeout(() => {
                confettiContainer.classList.add('hidden');
            }, 6000);
        }

        // Select prize by probability with better randomization
        function selectPrizeByProbability() {
            const totalProbability = prizes.reduce((sum, prize) => sum + (prize.probability || 1), 0);
            let random = Math.random() * totalProbability;
            
            // Shuffle prizes array to avoid bias
            const shuffledPrizes = [...prizes].sort(() => Math.random() - 0.5);
            
            for (const prize of shuffledPrizes) {
                random -= (prize.probability || 1);
                if (random <= 0) {
                    return prize;
                }
            }
            
            return prizes[0];
        }

        // Show prize result with enhanced UI
        async function showPrizeResult(prize) {
            const modal = document.getElementById('resultModal');
            const modalContent = modal.querySelector('.modal-content');
            const prizeDisplay = document.getElementById('prizeDisplay');
            const prizeInstructions = document.getElementById('prizeInstructions');
            const downloadButton = document.getElementById('downloadButton');
            const resultEmoji = document.getElementById('resultEmoji');
            const resultTitle = document.getElementById('resultTitle');
            
            if (isRealPrize(prize)) {
                resultEmoji.textContent = 'ğŸ‰';
                resultTitle.textContent = 'Ù…Ø¨Ø±ÙˆÙƒ! Ù„Ù‚Ø¯ Ø±Ø¨Ø­Øª';
                resultTitle.className = 'text-2xl font-bold text-hero-green mb-4';
                
                prizeDisplay.innerHTML = `
                    <div class="text-4xl mb-3">${prize.icon}</div>
                    <div class="text-2xl font-bold" style="color: ${prize.color}">${prize.text}</div>
                    ${currentCustomer.couponCode ? `
                        <div class="mt-2 text-sm text-gray-600 dark:text-gray-400">
                            Ø±Ù…Ø² Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†: <span class="font-mono font-bold text-hero-red">${currentCustomer.couponCode}</span>
                        </div>
                    ` : ''}
                `;
                
                prizeInstructions.classList.remove('hidden');
                downloadButton.classList.remove('hidden');
                
            } else {
                resultEmoji.textContent = 'ğŸ”„';
                resultTitle.textContent = 'Ø£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©!';
                resultTitle.className = 'text-2xl font-bold text-hero-blue mb-4';
                
                prizeDisplay.innerHTML = `
                    <div class="text-4xl mb-3">${prize.icon}</div>
                    <div class="text-xl font-bold" style="color: ${prize.color}">${prize.text}</div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-3">
                        ${spinsRemaining > 0 ? 'ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!' : 'Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©'}
                    </p>
                `;
                
                prizeInstructions.classList.add('hidden');
                downloadButton.classList.add('hidden');
            }
            
            modal.classList.remove('hidden');
            setTimeout(() => {
                modalContent.classList.add('show');
            }, 100);
        }

        // Enhanced prize image generation
        function downloadPrizeImage() {
            if (!currentCustomer || !currentCustomer.prize) {
                showToast('Ø®Ø·Ø£', 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙƒÙˆØ¨ÙˆÙ† Ù„Ù„ØªØ­Ù…ÙŠÙ„', 'error');
                return;
            }
            
            showLoading(true, 'Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†...', 75);
            
            // Create high-quality canvas
            const canvas = document.createElement('canvas');
            canvas.width = 1200;
            canvas.height = 800;
            const ctx = canvas.getContext('2d');
            
            // Enable high-quality rendering
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';
            
            // Background with enhanced gradient
            const gradient = ctx.createLinearGradient(0, 0, 1200, 800);
            gradient.addColorStop(0, '#dc2626');
            gradient.addColorStop(0.3, '#ea580c');
            gradient.addColorStop(0.7, '#eab308');
            gradient.addColorStop(1, '#16a34a');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 1200, 800);
            
            // Add pattern overlay
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            for (let i = 0; i < 1200; i += 40) {
                for (let j = 0; j < 800; j += 40) {
                    ctx.fillRect(i, j, 20, 20);
                }
            }
            
            // Header background
            ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
            ctx.roundRect(50, 50, 1100, 200, 20);
            ctx.fill();
            
            // Hero Bite Burger Logo (text-based)
            ctx.fillStyle = '#16a34a';
            ctx.font = 'bold 48px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('HERO BITE BURGER', 600, 120);
            
            // Subtitle
            ctx.fillStyle = '#dc2626';
            ctx.font = 'bold 36px Arial';
            ctx.fillText('ğŸ‰ ÙƒÙˆØ¨ÙˆÙ† Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© ğŸ‰', 600, 180);
            
            // Customer info section
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.roundRect(50, 300, 1100, 180, 15);
            ctx.fill();
            
            ctx.fillStyle = '#1f2937';
            ctx.font = 'bold 32px Arial';
            ctx.textAlign = 'right';
            ctx.fillText(`Ø§Ù„Ø¹Ù…ÙŠÙ„: ${currentCustomer.name}`, 1100, 350);
            
            ctx.font = '24px Arial';
            ctx.fillText(`Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„: ${currentCustomer.phone}`, 1100, 390);
            
            if (currentCustomer.couponCode) {
                ctx.font = 'bold 20px monospace';
                ctx.fillStyle = '#dc2626';
                ctx.fillText(`Ø±Ù…Ø² Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†: ${currentCustomer.couponCode}`, 1100, 430);
            }
            
            // Prize section
            ctx.fillStyle = 'rgba(255, 235, 59, 0.9)';
            ctx.roundRect(50, 520, 1100, 120, 15);
            ctx.fill();
            
            ctx.fillStyle = '#b91c1c';
            ctx.font = 'bold 48px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(currentCustomer.prize, 600, 590);
            
            // Instructions
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.roundRect(50, 670, 1100, 80, 10);
            ctx.fill();
            
            ctx.fillStyle = '#374151';
            ctx.font = '20px Arial';
            ctx.fillText('Ø£Ø¸Ù‡Ø± Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ† Ù„Ù„ÙƒØ§Ø´ÙŠØ± Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¬Ø§Ø¦Ø²ØªÙƒ', 600, 700);
            
            // Date and validity
            ctx.font = '16px Arial';
            const issueDate = new Date().toLocaleDateString('ar-SA');
            const expiryDate = new Date(Date.now() + appSettings.couponValidityDays * 24 * 60 * 60 * 1000).toLocaleDateString('ar-SA');
            
            ctx.fillText(`ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±: ${issueDate}`, 400, 730);
            ctx.fillText(`ØµØ§Ù„Ø­ Ø­ØªÙ‰: ${expiryDate}`, 800, 730);
            
            // Border decoration
            ctx.strokeStyle = '#dc2626';
            ctx.lineWidth = 8;
            ctx.roundRect(20, 20, 1160, 760, 25);
            ctx.stroke();
            
            showLoading(false);
            
            // Download with timestamp
            const link = document.createElement('a');
            const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
            link.download = `herobite_ÙƒÙˆØ¨ÙˆÙ†_${currentCustomer.name.replace(/\s+/g, '_')}_${timestamp}.png`;
            link.href = canvas.toDataURL('image/png', 1.0);
            link.click();
            
            showToast('Ù†Ø¬Ø­', 'ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ† Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        // Enhanced sound effects
        function playSpinSound() {
            if (!audioContext) return;
            
            // Create a more complex spinning sound
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(200 + i * 50, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                }, i * 100);
            }
        }

        function playWinSound() {
            if (!audioContext) return;
            
            // Victory fanfare
            const frequencies = [523, 659, 784, 1047, 1319]; // C5, E5, G5, C6, E6
            frequencies.forEach((freq, index) => {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.4);
                }, index * 200);
            });
        }

        // Enhanced loading system
        function showLoading(show, text = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...', progress = 0) {
            const overlay = document.getElementById('loadingOverlay');
            const loadingText = document.getElementById('loadingText');
            const progressBar = document.getElementById('loadingProgress');
            
            if (show) {
                loadingText.textContent = text;
                progressBar.style.width = progress + '%';
                overlay.classList.remove('hidden');
                overlay.querySelector('.modal-content').classList.add('show');
                
                // Animate progress
                if (progress > 0) {
                    let currentProgress = 0;
                    const interval = setInterval(() => {
                        currentProgress += 2;
                        if (currentProgress >= progress) {
                            clearInterval(interval);
                        }
                        progressBar.style.width = Math.min(currentProgress, progress) + '%';
                    }, 50);
                }
            } else {
                progressBar.style.width = '100%';
                setTimeout(() => {
                    overlay.classList.add('hidden');
                    overlay.querySelector('.modal-content').classList.remove('show');
                    progressBar.style.width = '0%';
                }, 300);
            }
        }

        // Enhanced toast system
        function showToast(title, message, type = 'info') {
            const toast = document.getElementById('statusToast');
            const content = document.getElementById('toastContent');
            const icon = document.getElementById('toastIcon');
            const messageEl = document.getElementById('toastMessage');
            
            // Set icon and styling based on type
            const config = {
                success: { icon: 'âœ…', class: 'border-green-500' },
                error: { icon: 'âŒ', class: 'border-red-500' },
                warning: { icon: 'âš ï¸', class: 'border-yellow-500' },
                info: { icon: 'â„¹ï¸', class: 'border-blue-500' }
            };
            
            const toastConfig = config[type] || config.info;
            
            icon.textContent = toastConfig.icon;
            messageEl.innerHTML = `<strong>${title}</strong><br>${message}`;
            
            // Reset classes and add new ones
            content.className = 'bg-white dark:bg-gray-800 rounded-lg shadow-lg border-l-4 p-4 ' + toastConfig.class;
            
            toast.classList.remove('hidden');
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                hideToast();
            }, 5000);
        }

        function hideToast() {
            document.getElementById('statusToast').classList.add('hidden');
        }

        // Close modal with animation
        function closeModal() {
            const modal = document.getElementById('resultModal');
            const modalContent = modal.querySelector('.modal-content');
            
            modalContent.classList.remove('show');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
            
            // Remove winner highlighting
            document.querySelectorAll('.wheel-segment').forEach(segment => {
                segment.classList.remove('winner');
            });
        }

        // New customer with enhanced reset
        function newCustomer() {
            closeModal();
            
            // Reset form
            document.getElementById('customerForm').reset();
            removeFile();
            
            // Clear all field errors
            ['nameError', 'phoneError', 'emailError', 'fileError'].forEach(clearFieldError);
            
            // Reset wheel
            document.getElementById('wheel').style.transform = 'rotate(0deg)';
            document.querySelectorAll('.wheel-segment').forEach(segment => {
                segment.classList.remove('winner');
            });
            
            // Hide download coupon section
            document.getElementById('downloadCouponSection').classList.add('hidden');
            
            // Show registration form
            document.getElementById('wheelGame').classList.add('hidden');
            document.getElementById('registrationForm').classList.remove('hidden');
            
            // Reset all variables
            currentCustomer = null;
            winningSegmentIndex = -1;
            hasSpun = false;
            hasWonRealPrize = false;
            participantId = null;
            spinsRemaining = appSettings.maxAttempts;
            
            // Reload stats
            loadStats();
            
            showToast('ØªÙ…', 'ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù„Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯', 'success');
        }

        // Canvas roundRect polyfill for older browsers
        if (!CanvasRenderingContext2D.prototype.roundRect) {
            CanvasRenderingContext2D.prototype.roundRect = function (x, y, width, height, radius) {
                if (width < 2 * radius) radius = width / 2;
                if (height < 2 * radius) radius = height / 2;
                this.beginPath();
                this.moveTo(x + radius, y);
                this.arcTo(x + width, y, x + width, y + height, radius);
                this.arcTo(x + width, y + height, x, y + height, radius);
                this.arcTo(x, y + height, x, y, radius);
                this.arcTo(x, y, x + width, y, radius);
                this.closePath();
                return this;
            };
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                if (!document.getElementById('resultModal').classList.contains('hidden')) {
                    closeModal();
                }
                if (!document.getElementById('loadingOverlay').classList.contains('hidden')) {
                    // Don't allow escape during loading
                    e.preventDefault();
                }
            }
        });

        // Service Worker registration for offline capability (optional)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                // Uncomment the following lines if you create a service worker
                // navigator.serviceWorker.register('/sw.js')
                //     .then(function(registration) {
                //         console.log('SW registered: ', registration);
                //     })
                //     .catch(function(registrationError) {
                //         console.log('SW registration failed: ', registrationError);
                //     });
            });
        }
    </script>


</body></html>